<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html {
        height: 100%;
	font-family: Verdana, Arial, sans-serif;
      }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 100% }
      #left-panel {
	float: left;
	width: 300px;
	height: 100%; 
	background-color: #eeeeff;
	border: 5px solid #aaaaff;
      }
      div.left-panel-block {
        min-height: 100px;
        border-bottom: 3px solid #aaaaff;
	padding: 10px;
      }
      div.header {
        padding: 0px;
	background-color: white;
	border-bottom: 1px solid #aaaaff;
      }
      div.header h1 {
	font-size: 16px;
      }
      div.content  {
      }
      div.header p {
	font-size: 12px;
      }
      .bike-cell {
	border: 1px solid black;
	margin: 0px;
      }
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAtozww5bfNzP-MXagYbLAr9gT6wTgHYdg&sensor=false">
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script>
    var maxBikes = 0, startCircle, map, bikeCenter, bikeTrack,
	  bikeOldLatDeg, bikeOldLngDeg, bikeLatAvgDeg, bikeLngAvgDeg;
      if (typeof Number.prototype.toRad == 'undefined') {
	Number.prototype.toRad = function() {
	  return this * Math.PI / 180;
	}
      }
      if (typeof Number.prototype.toDeg == 'undefined') {
	Number.prototype.toDeg = function() {
	  return this * 180 / Math.PI;
	}
      }
    </script>
     
    <script type="text/javascript">
      function initialize() {
	var mapOptions = {
	  center: new google.maps.LatLng(38.903, -77.034),
	  zoom: 14,
	  mapTypeId: google.maps.MapTypeId.ROADMAP
	};
	map = new google.maps.Map(document.getElementById("map-canvas"),
	  mapOptions);
	bikeTrack = new google.maps.MVCArray([
	  new google.maps.LatLng(38.903, -77.035),
	  new google.maps.LatLng(38.903, -77.035)
	]);
	startCircle = new google.maps.Circle({
	  center: new google.maps.LatLng(38.897, -77.04),
	  fillColor: '#000000',
	  fillOpacity: 0.4,
	  strokeColor: '#000000',
	  strokeOpacity: 1.0,
	  strokeWeight: 2,
	  radius: 400
	});
	bikeCenter = new google.maps.Polyline({
	  path: bikeTrack,
	  strokeColor: '#FF0000',
	  strokeOpacity: 1.0,
	  strokeWeight: 3
	});
	// startCircle.setMap(map);
	bikeCenter.setMap(map);
	}
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>
  <body>
    <div id="left-panel">
      <div class="left-panel-block">
	<div class="header">
	  <h1>Bikeflow</h1>
	</div>
	<div class="content">
	  <p>Bikeshare system visualization</p>
	</div>
      </div>
      <div class="left-panel-block" id="settings">
	<div class="header">
	  <h1>Settings</h2>
	</div>
	<div class="content">
	  <select>
	      <option  value="vigo.json">vigo</option>
	      <option  value="melbourne.json">melbourne</option>
	      <option  value="capitalbikeshare.json">capitalbikeshare</option>
	      <option  value="vigo.json">vigo</option>
	  </select>
	</div>
      </div>
      <div class="left-panel-block">
	<div class="header">
	  <h1>Current Data</h1>
	</div>
	<div class="content">
	  <table>
	     <tr class="bike-row">
	        <td class="bike-cell" id="zero-one">bikes</td>
	        <td class="bike-cell" id="zero-two"></td>
	     </tr>
	     <tr class="bike-row">
	        <td class="bike-cell" id="one-one">max bikes</td>
	        <td class="bike-cell" id="one-two"></td>
	     </tr>
	     <tr class="bike-row">
	        <td class="bike-cell" id="two-one">docks</td>
	        <td class="bike-cell" id="two-two"></td>
	     </tr>
	     <tr class="bike-row">
	        <td class="bike-cell" id="three-one">Ctr of Mass</td>
	        <td class="bike-cell" id="three-two"></td>
	     </tr>
	  </table>
	  <div id="stations">
	  </div>
	</div>
      </div>
    </div>
    <script>
      var bikeLatAccE6 = 0, bikeLngAccE6 = 0, dockLatAccE6 = 0, dockLngAccE6 = 0,
      bikesAcc = 0, docksAcc = 0;
      var dLat, dLon, a, c, d;
      var R = 6371 / 1.609344; // miles

      window.setInterval(function() {
	$.getJSON("http://api.citybik.es/capitalbikeshare.json?callback=?", {
	    format: 'json'
	  },
	  function(data) {
	    var dataString;
	    bikesAcc = 0;
	    bikeLatAccE6 = 0;
	    bikeLngAccE6 = 0;
	    docksAcc = 0;
	    dockLatAccE6 = 0;
	    dockLngAccE6 = 0;
	    $.each(data, function(i,value){
	      var bikes = value.bikes;
	      var docks = value.free;
	      bikesAcc += bikes;
	      bikeLatAccE6 += bikes * value.lat;
	      bikeLngAccE6 += bikes * value.lng;
	      docksAcc += docks;
	      dockLatAccE6 += docks * value.lat;
	      dockLngAccE6 += docks * value.lng;
	      bikeLatAvgDeg = 0.000001 * bikeLatAccE6 / bikesAcc;
	      bikeLngAvgDeg = 0.000001 * bikeLngAccE6 / bikesAcc;
	      dockLatAvgDeg = 0.000001 * dockLatAccE6 / docksAcc;
	      dockLngAvgDeg = 0.000001 * dockLngAccE6 / docksAcc;
	      dLat = 0;
	      dLng = 0;
	    });
	    if (bikesAcc > maxBikes) {
	      maxBikes = bikesAcc;
	    }
	    $('#zero-two').text(bikesAcc);
	    $('#one-two').text(maxBikes);
	    $('#two-two').text(docksAcc);
	    $('#three-two').text( bikeLatAvgDeg.toFixed(3) +
		  ', ' + bikeLngAvgDeg.toFixed(3));
	    bikeTrack.push(new google.maps.LatLng(bikeLatAvgDeg,
		  bikeLngAvgDeg));
	  });
      }, 20000);
  </script>
  <div id="map-canvas"/>
</body>
</html>
